使用Minikube-in-a-Container和Jenkins创建Istio

AspenMesh提供一种Istio的分布式架构支持，这意味着即使与上游Istio项目无关，我们也需要能够测试和修复Bug。为此我们已开发构建了我们自己的打包和测试基础架构方案。如果你对Istio的CI（持续集成）也感兴趣，请参考我们这些已经投入使用组件中可能是有用，但还没有提交给Circle CI或GKE的组件。这篇文章将展示我们是如何制作一个更新的后的Minikube-in-a-Container容器和一个使用Jenkins来构建和测试Istio的流程脚本。如果你想要，你可以在docker上运行minikube容器，然后在容器中得到当你不需要使用时可随时删除的一个功能性的kubernetes集群。Jenkins bits可帮助你构建Isti。也可以作为一个开端，以便在容器内构建容器。

Minikube-in-a-container

这部分描述了我们如何构建一个在构建过程中用来运行Istio冒烟测试的Minikube-in-a-container镜像。这不是我们最初的想法，我们最初使用本地localkube环境。我们不能让它在特定环境外工作，我们认为这是由于localkube和minikube之间有一点差异导致的。所以这是一个作为我们修复它使它能正常工作的记录。我们还添加了一些额外选项和工具，以便在生成的容器中使用Istio。这没有什么太花哨的东西，但如果你要做类似的事情，我们希望它给你启发。

Minikube可能对你来说是一个可以在随身携带的笔记本上通过虚机运行自己kubernetes集群的非常熟悉的项目。这种方法非常方便，但在某些情况下（比如不提供嵌套虚拟化的云提供商），你不能或不希望基于虚机来完成。由于docker现在可以运行在docker内部，我们决定尝试在docker容器内制作我们自己的kubernetes集群。一个临时的kubernetes容器很容易启动，进行一些测试，并在完成后进行删除。同时这也非常适合持续集成。
在我们的模型中，Kubernetes集群创建子docker容器（而不是Jérôme Petazzoni所想的兄弟容器）。我们故意这样做，我们宁愿隔离子容器，而不是共享Docker构建缓存。但是你应该在将你应用改造为在Docker中运行Docker之前阅读Jérôme的文章，也许DooD（在Docker外运行Docker）是对你而言更好的方案。这篇文章供你参考。我们避免架构“变得更坏”的同时，对看起来“坏”和“丑”部分是进行避免。